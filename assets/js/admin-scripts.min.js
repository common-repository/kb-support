var KBSShowNotice,kbs_vars;function kbs_load_ticket_replies(e,s,t){jQuery("#kbs-replies-loader").html('<img src="'+kbs_vars.ajax_loader+'" />'),jQuery.post(ajaxurl,{action:"kbs_display_ticket_replies",kbs_ticket_id:e,kbs_reply_id:s,kbs_page:t},function(e){jQuery(".kbs-historic-reply-option-fields").append(e),jQuery("#kbs-replies-loader").html("")})}function kbs_load_ticket_notes(e,s){jQuery("#kbs-notes-loader").html('<img src="'+kbs_vars.ajax_loader+'" />'),jQuery.post(ajaxurl,{action:"kbs_display_ticket_notes",kbs_ticket_id:e,kbs_note_id:s},function(e){jQuery(".kbs-notes-option-fields").prepend(e),jQuery("#kbs-notes-loader").html("")})}jQuery(document).ready(function(e){var s=e(".kbs_datepicker");s.length>0&&s.datepicker({dateFormat:"mm/dd/yy"}),e(".kbs_select_chosen").chosen({inherit_select_classes:!0,placeholder_text_single:kbs_vars.one_option,placeholder_text_multiple:kbs_vars.one_or_more_option}),e(".kbs_select_chosen .chosen-search input").each(function(){var s=e(this).parent().parent().parent().prev("select.kbs_select_chosen").data("search-placeholder");e(this).attr("placeholder",s)}),e(".chosen-choices").on("click",function(){var s=e(this).parent().prev().data("search-placeholder");void 0===s&&(s=kbs_vars.type_to_search),e(this).children("li").children("input").attr("placeholder",s)}),({init:function(){this.general(),this.uploads()},general:function(){var s=e(".kbs-color-picker");s.length&&s.wpColorPicker(),e(".logged_in_only").length&&e(".logged_in_only").is(":checked")&&e(".kbs_option_auto_add_user").hide(),e(".recaptcha_version").length&&"v2"!==e(".recaptcha_version").val()&&(e(".kbs_option_recaptcha_theme").hide(),e(".kbs_option_recaptcha_type").hide(),e(".kbs_option_recaptcha_size").hide()),e(document.body).on("change",".logged_in_only",function(){e(this).is(":checked")?e(".kbs_option_auto_add_user").fadeOut("fast"):e(".kbs_option_auto_add_user").fadeIn("fast")}),e(document.body).on("change",".recaptcha_version",function(){"v2"!==e(".recaptcha_version").val()?(e(".kbs_option_recaptcha_theme").fadeOut("fast"),e(".kbs_option_recaptcha_type").fadeOut("fast"),e(".kbs_option_recaptcha_size").fadeOut("fast")):(e(".kbs_option_recaptcha_theme").fadeIn("fast"),e(".kbs_option_recaptcha_type").fadeIn("fast"),e(".kbs_option_recaptcha_size").fadeIn("fast"))})},uploads:function(){if("undefined"==typeof wp||"1"!==kbs_vars.new_media_ui){var s,t=e(".kbs_settings_upload_button");t.length>0&&(window.formfield="",e(document.body).on("click",t,function(s){s.preventDefault(),window.formfield=e(this).parent().prev(),window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(kbs_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3),tb_show(kbs_vars.add_new_ticket,"media-upload.php?TB_iframe=true")}),window.kbs_send_to_editor=window.send_to_editor,window.send_to_editor=function(s){window.formfield?(imgurl=e("a","<div>"+s+"</div>").attr("href"),window.formfield.val(imgurl),window.clearInterval(window.tbframe_interval),tb_remove()):window.kbs_send_to_editor(s),window.send_to_editor=window.kbs_send_to_editor,window.formfield="",window.imagefield=!1})}else window.formfield="",e(document.body).on("click",".kbs_settings_upload_button",function(t){t.preventDefault();var a=e(this);if(window.formfield=e(this).parent().prev(),s){s.open();return}(s=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:a.data("uploader_title"),button:{text:a.data("uploader_button_text")},multiple:!1})).on("menu:render:default",function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})}),s.on("insert",function(){s.state().get("selection").each(function(e){e=e.toJSON(),window.formfield.val(e.url)})}),s.open()})}}).init(),e(document.body).on("click",".toggle-view-reply-option-section",function(s){s.preventDefault(),e(this).html()===kbs_vars.view_reply?e(this).html(kbs_vars.hide_reply):e(this).html(kbs_vars.view_reply),e(this).parents(".kbs-replies-row-header").siblings(".kbs-replies-content-wrap").slideToggle()}),e(document.body).on("click",".toggle-view-note-option-section",function(s){s.preventDefault(),e(this).html()===kbs_vars.view_note?e(this).html(kbs_vars.hide_note):e(this).html(kbs_vars.view_note),e(this).parents(".kbs-notes-row-header").siblings(".kbs-notes-content-wrap").slideToggle()}),({init:function(){this.notes(),this.options(),this.participants(),this.reply(),this.save()},save:function(){e(document.body).on("click","#save-post",function(){var s="";if("undefined"!=typeof tinyMCE&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&tinyMCE.triggerSave(),(s=e("#kbs_ticket_reply").val()).length>0)return confirm(kbs_vars.reply_has_data)}),e(document.body).on("change","#ticket_status",function(){"kbs_ticket"!==kbs_vars.post_type||"closed"!==e(this).val()||kbs_vars.disable_closure_email?(e("#kbs-closure-option").remove(),e("#kbs-closure-email").remove(),e('label[for="kbs-closure-email"]').remove()):(e(this).parent().append('<br id="kbs-closure-option">'),e(this).parent().append('<input type="checkbox" id="kbs-closure-email" name="kbs_closure_email" value="1" style="margin-top:0; margin-left: 4px;">'),e(this).parent().append('<label for="kbs-closure-email">'+kbs_vars.send_closure_email+"</label>"))})},options:function(){e(document.body).on("click",".toggle-flagged-status-option-section",function(s){s.preventDefault();var t={ticket_id:kbs_vars.post_id,flagged:e(this).data("flag"),action:"kbs_set_ticket_flagged_status"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,beforeSend:function(){e("#kbs-ticket-metabox-fields").addClass("kbs-mute"),e(".toggle-flagged-status-option-section").html(kbs_vars.please_wait)},success:function(s){!0===s.success&&("flagged"===s.data.flagged?(e("#kbs-ticket-flag-notice").show(),e(".toggle-flagged-status-option-section").html(kbs_vars.ticket_unflag),e(".toggle-flagged-status-option-section").data("flag","0")):(e("#kbs-ticket-flag-notice").hide(),e(".toggle-flagged-status-option-section").html(kbs_vars.ticket_flag),e(".toggle-flagged-status-option-section").data("flag","1")),kbs_load_ticket_notes(kbs_vars.post_id,s.data.note_id)),e("#kbs-ticket-metabox-fields").removeClass("kbs-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document.body).on("click",".toggle-add-reply-option-section",function(s){s.preventDefault(),e("html, body").animate({scrollTop:e(".kbs-historic-reply-option-fields").offset().top},500)}),e(document.body).on("click",".toggle-view-participants-option-section",function(s){s.preventDefault();var t=e(this).html()===kbs_vars.view_participants;t?e(this).html(kbs_vars.hide_participants):e(this).html(kbs_vars.view_participants),e("#kbs-ticket-participants-fields").slideToggle(),t&&e("html, body").animate({scrollTop:e("#kbs-ticket-participants-fields").offset().top},500)}),e(document.body).on("click",".toggle-view-submission-option-section",function(s){s.preventDefault();var t=e(this).html()===kbs_vars.view_submission;t?e(this).html(kbs_vars.hide_submission):e(this).html(kbs_vars.view_submission),e("#kbs-ticket-formdata-fields").slideToggle(),t&&e("html, body").animate({scrollTop:e("#kbs-ticket-formdata-fields").offset().top},500)})},participants:function(){e(document.body).on("click","#kbs-add-participant",function(s){s.preventDefault(s);var t=e("#participant_id").val(),a=e("#participant_email").val();if("-1"!==t||a){var i={ticket_id:kbs_vars.post_id,participant:t,email:a,action:"kbs_add_participant"};e.ajax({type:"POST",dataType:"json",data:i,url:ajaxurl,beforeSend:function(){e("#kbs-ticket-participants-fields").addClass("kbs-mute"),e("#kbs-add-participant").attr("disabled",!0)},success:function(s){!0===s.success&&("-1"!==t&&e("#participant_id option:selected").remove(),e(".kbs-ticket-participants-list").html(s.data.list),e("#participant-count").text(s.data.count)),e("#participant_email").empty(),e("#participant_id").val("-1"),e("#participant_id").trigger("chosen:updated"),e("#kbs-add-participant").attr("disabled",!1),e("#kbs-ticket-participants-fields").removeClass("kbs-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}),e(document.body).on("click",".remove-participant",function(s){s.preventDefault(s);var t={participant:e(this).data("participant"),ticket_id:kbs_vars.post_id,action:"kbs_remove_participant"};e.ajax({type:"POST",dataType:"json",data:t,url:ajaxurl,beforeSend:function(){e("#kbs-ticket-participants-fields").addClass("kbs-mute"),e("#kbs-add-participant").attr("disabled",!0)},success:function(s){!0===s.success&&(e(".kbs-ticket-participants-list").html(s.data.list),e("#participant-count").text(s.data.count)),e("#kbs-add-participant").attr("disabled",!1),e("#kbs-ticket-participants-fields").removeClass("kbs-mute")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},reply:function(){"1"===kbs_vars.editing_ticket&&"1"===kbs_vars.reply_alerts&&(e(document).on("heartbeat-send",function(s,t){var a=e("#kbs-latest-reply").val();t.kbs_last_reply=a,t.kbs_ticket_id=kbs_vars.post_id}),e(document).on("heartbeat-tick",function(s,t){t.has_new_reply&&(e("#kbs-latest-reply").val(t.has_new_reply),confirm(kbs_vars.new_reply_notice)&&(e(".kbs-historic-reply-option-fields").empty(),kbs_load_ticket_replies(kbs_vars.post_id,0,1)))})),e(document.body).on("click",".reply-delete",function(s){s.preventDefault(),confirm(kbs_vars.delete_ticket_warn)&&(window.location=e(this).attr("href"))}),e(document.body).on("click","#kbs-reply-close, #kbs-reply-update",function(s){s.preventDefault();var t=kbs_vars.post_id,a="",i=kbs_vars.agent_set_status?e("#ticket_reply_status").val():kbs_vars.default_reply_status,o=e("#post").serialize(),n=e("#kbs_nonce").val();if("undefined"!=typeof tinyMCE&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&tinyMCE.triggerSave(),0===(a=e("#kbs_ticket_reply").val()).length)return window.alert(kbs_vars.no_ticket_reply_content),!1;if("kbs-reply-close"!==s.target.id&&"closed"!==i||!1!==confirm(kbs_vars.ticket_confirm_close)){var l={ticket_id:t,response:a,status:i,close_ticket:"kbs-reply-close"===s.target.id?1:0,form_data:o,kbs_nonce:n,action:"kbs_insert_ticket_reply"};e.ajax({type:"POST",dataType:"json",data:l,url:ajaxurl,beforeSend:function(){e(".kbs-reply").hide(),e("#kbs-new-reply-loader").html('<img src="'+kbs_vars.ajax_loader+'" />')},success:function(s){if(s.reply_id)return kbs_load_ticket_replies(t,s.reply_id,1),window.location.href=kbs_vars.admin_url+"?kbs-action=ticket_reply_added&ticket_id="+t,!0;window.alert(kbs_vars.reply_not_added),e("#kbs-new-reply-loader").html(""),e(".kbs-reply").show()}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}),e(document.body).on("click","#kbs-replies-next-page",function(){var s=e("#kbs-replies-next-page").data("ticket-id"),t=e("#kbs-replies-next-page").data("load-page");e(".kbs-replies-load-more").remove(),kbs_load_ticket_replies(s,0,t)})},notes:function(){e(document.body).on("click","#kbs-add-note",function(){var s=e("#kbs_new_note").val(),t=kbs_vars.post_id;if(s.length<1){window.alert(kbs_vars.no_note_content);return}e.ajax({type:"POST",dataType:"json",data:{ticket_id:t,note_content:s,action:"kbs_insert_ticket_note"},url:ajaxurl,beforeSend:function(){e("#kbs-add-note").hide(),e("#kbs-new-note-loader").html('<img src="'+kbs_vars.ajax_loader+'" />')},success:function(s){s.note_id?(kbs_load_ticket_notes(t,s.note_id),e("#kbs_new_note").val("")):window.alert(kbs_vars.note_not_added),e("#kbs-new-note-loader").html(""),e("#kbs-add-note").show()}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),"1"===kbs_vars.editing_ticket&&setTimeout(function(){kbs_load_ticket_replies(kbs_vars.post_id,0,1),kbs_load_ticket_notes(kbs_vars.post_id,0)},200)}}).init(),({init:function(){this.forms(),this.move()},forms:function(){var s=function(s){"text"===s||"date_field"===s||"department"===s||"email"===s||"number"===s||"select"===s||"textarea"===s||"url"===s?e("#kbs_meta_field_placeholder_wrap").show():e("#kbs_meta_field_placeholder_wrap").hide(),"text"===s||"date_field"===s||"department"===s||"email"===s||"hidden"===s||"number"===s||"select"===s||"textarea"===s||"url"===s?e("#kbs_meta_field_hide_label_wrap").show():e("#kbs_meta_field_hide_label_wrap").hide(),"select"===s||"checkbox_list"===s||"radio"===s?e("#kbs_meta_field_select_options_wrap").show():e("#kbs_meta_field_select_options_wrap").hide(),"select"===s?e("#kbs_meta_field_select_multiple_wrap").show():e("#kbs_meta_field_select_multiple_wrap").hide(),"select"===s||"department"===s||"ticket_category_dropdown"===s?(e("#kbs_meta_field_select_blank_wrap").show(),e("#kbs_meta_field_select_searchable_wrap").show()):(e("#kbs_meta_field_select_blank_wrap").hide(),e("#kbs_meta_field_select_searchable_wrap").hide()),"checkbox"===s?e("#kbs_meta_field_option_selected_wrap").show():e("#kbs_meta_field_option_selected_wrap").hide(),"checkbox"===s||"file_upload"===s?e("#kbs_meta_field_required_wrap").hide():e("#kbs_meta_field_required_wrap").show(),"recaptcha"===s?(e("#kbs_meta_field_required_wrap").hide(),e("#kbs_meta_field_label_class_wrap").hide(),e("#kbs_meta_field_input_class_wrap").hide()):(e("#kbs_meta_field_required_wrap").show(),e("#kbs_meta_field_label_class_wrap").show(),e("#kbs_meta_field_input_class_wrap").show()),"text"===s||"email"===s||"hidden"===s||"url"===s||"textarea"===s||"rich_editor"===s||"department"===s?e("#kbs_meta_field_mapping_wrap").show():e("#kbs_meta_field_mapping_wrap").hide(),"hidden"===s?e("#kbs_meta_field_value_wrap").show():e("#kbs_meta_field_value_wrap").hide(),"post_title"===e("#kbs_field_mapping").val()?e("#kbs_meta_field_kb_search_wrap").show():e("#kbs_meta_field_kb_search_wrap").hide()};kbs_vars.editing_field_type&&s(kbs_vars.editing_field_type);var t=e(".kbs_field_type");e(document.body).on("change",t,function(){s(t.val())}),e(document.body).on("change",e("#kbs_field_mapping"),function(){"post_title"===e("#kbs_field_mapping").val()?e("#kbs_meta_field_kb_search_wrap").show():e("#kbs_meta_field_kb_search_wrap").hide()}),e(document.body).on("change",e("#kbs_field_select_chosen"),function(){e("#kbs_field_select_chosen").is(":checked")?e("#kbs_meta_field_select_search_text_wrap").show("fast"):e("#kbs_meta_field_select_search_text_wrap").hide("fast")}),e(document.body).on("click","#kbs-add-form-field",function(s){if(s.preventDefault(),e("#kbs_field_label").val().length<1)return window.alert(kbs_vars.field_label_missing),!1;if("-1"===e("#kbs_field_type").val())return window.alert(kbs_vars.field_type_missing),!1;var t=e("#form_return_url").val(),a={action:"kbs_add_form_field",blank:e("#kbs_field_select_blank").val(),chosen:e("#kbs_field_select_chosen").is(":checked")?e("#kbs_field_select_chosen").val():0,chosen_search:e("#kbs_field_select_chosen_search").val(),description:e("#kbs_field_description").val(),description_pos:e("input[name=kbs_field_description_pos]").filter(":checked").val(),form_data:e("#post").serialize(),form_id:kbs_vars.post_id,hide_label:e("#kbs_field_hide_label").is(":checked")?e("#kbs_field_hide_label").val():0,input_class:e("#kbs_field_input_class").val(),kb_search:e("#kbs_field_kb_search").is(":checked")?e("#kbs_field_kb_search").val():0,label:e("#kbs_field_label").val(),label_class:e("#kbs_field_label_class").val(),mapping:e("#kbs_field_mapping").val(),placeholder:e("#kbs_field_placeholder").val(),required:e("#kbs_field_required").is(":checked")?e("#kbs_field_required").val():0,selected:e("#kbs_field_option_selected").is(":checked")?e("#kbs_field_option_selected").val():0,select_multiple:e("#kbs_field_select_multiple").is(":checked")?e("#kbs_field_select_multiple").val():0,select_options:e("textarea#kbs_field_select_options").val(),type:e("#kbs_field_type").val(),value:e("#kbs_field_value").val()};e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(){e("#kbs-field-add").addClass("kbs-hidden"),e("#kbs-loading").removeClass("kbs-hidden")},success:function(e){return window.location.href=t+"&kbs-message="+e.message,!0}}).fail(function(s){e("#kbs-field-add").removeClass("kbs-hidden"),e("#kbs-loading").addClass("kbs-hidden"),window.console&&window.console.log&&console.log(s)})}),e(document.body).on("click","#kbs-save-form-field",function(s){if(s.preventDefault(),e("#kbs_field_label").val().length<1)return window.alert(kbs_vars.field_label_missing),!1;if("-1"===e("#kbs_field_type").val())return window.alert(kbs_vars.field_type_missing),!1;var t=e("#form_return_url").val(),a={action:"kbs_save_form_field",blank:e("#kbs_field_select_blank").val(),chosen:e("#kbs_field_select_chosen").is(":checked")?e("#kbs_field_select_chosen").val():0,chosen_search:e("#kbs_field_select_chosen_search").val(),description:e("#kbs_field_description").val(),description_pos:e("input[name=kbs_field_description_pos]").filter(":checked").val(),field_id:e("#kbs_edit_field").val(),form_data:e("#post").serialize(),form_id:kbs_vars.post_id,hide_label:e("#kbs_field_hide_label").is(":checked")?e("#kbs_field_hide_label").val():0,input_class:e("#kbs_field_input_class").val(),kb_search:e("#kbs_field_kb_search").is(":checked")?e("#kbs_field_kb_search").val():0,label:e("#kbs_field_label").val(),label_class:e("#kbs_field_label_class").val(),mapping:e("#kbs_field_mapping").val(),placeholder:e("#kbs_field_placeholder").val(),required:e("#kbs_field_required").is(":checked")?e("#kbs_field_required").val():0,selected:e("#kbs_field_option_selected").is(":checked")?e("#kbs_field_option_selected").val():0,select_options:e("textarea#kbs_field_select_options").val(),select_multiple:e("#kbs_field_select_multiple").is(":checked")?e("#kbs_field_select_multiple").val():0,type:e("#kbs_field_type").val(),value:e("#kbs_field_value").val()};e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(){e("#kbs-field-save").addClass("kbs-hidden"),e("#kbs-loading").removeClass("kbs-hidden")},success:function(e){return window.location.href=t+"&kbs-message="+e.message,!0}}).fail(function(s){e("#kbs-field-save").removeClass("kbs-hidden"),e("#kbs-loading").addClass("kbs-hidden"),window.console&&window.console.log&&console.log(s)})})},move:function(){e(".kbs_sortable_table tbody").sortable({handle:".kbs_draghandle",items:".kbs_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var s=e(this).sortable("serialize")+"&action=kbs_order_form_fields";e.post(ajaxurl,s,function(){})}})}}).init();var t={vars:{customer_wrap_editable:e(".kbs-customer-wrapper .editable"),customer_wrap_edit_item:e(".kbs-customer-wrapper .edit-item"),user_id:e('input[name="customerinfo[user_id]"]'),note:e("#customer-note")},init:function(){this.add_customer(),this.new_customer(),this.edit_customer(),this.cancel_edit(),this.add_email(),this.user_search(),this.remove_user(),this.add_note(),this.delete_checked()},add_customer:function(){e(document.body).on("click","#kbs-add-customer-save",function(s){s.preventDefault();var t=e(this),a=t.parent(),i=e("#customer-name").val(),o=e("#customer_company").val(),n=e("#customer-email").val(),l=e("add_customer_nonce").val();e.ajax({type:"POST",dataType:"json",data:{action:"kbs_add_customer",customer_name:i,customer_company:o,customer_email:n,_wpnonce:l},url:ajaxurl,beforeSend:function(){e(".notice-wrap").html(""),a.find(".spinner").css("visibility","visible"),t.attr("disabled",!0)},success:function(s){if(!s.error)return window.location.href=s.redirect,!0;t.attr("disabled",!1),e(".notice-wrap").html('<div class="notice notice-error"><p>'+s.message+"</p></div>"),a.find(".spinner").css("visibility","hidden")}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},new_customer:function(){e(document.body).on("click","#kbs-new-customer-save",function(s){s.preventDefault();var t=e(this),a=e("#kbs_name").val(),i=e("#kbs_email").val(),o=e("#kbs_company").val();if(""===a){alert(kbs_vars.customer_name_required);return}if(""===i){alert(kbs_vars.customer_email_required);return}e.ajax({type:"POST",dataType:"json",data:{action:"kbs_new_customer_for_ticket",customer_name:a,customer_email:i,customer_company:o},url:ajaxurl,beforeSend:function(){t.attr("disabled",!0),e("#add-customer").addClass("kbs-mute")},success:function(s){s.success?(e("#kbs_customer_id").append(s.data.option),e("#kbs_customer_id").val(s.data.id),e("#kbs_customer_id").trigger("chosen:updated"),t.attr("disabled",!1),e("#kbs_name").val(""),e("#kbs_email").val(""),e("#kbs_company").val("-1"),e("#kbs_company").trigger("chosen:updated"),tb_remove()):(t.attr("disabled",!1),s.data.message&&alert(s.data.message))}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})},edit_customer:function(){e(document.body).on("click","#edit-customer",function(e){e.preventDefault(),t.vars.customer_wrap_editable.hide(),t.vars.customer_wrap_edit_item.fadeIn().css("display","block")})},cancel_edit:function(){e(document.body).on("click","#kbs-edit-customer-cancel",function(s){s.preventDefault(),t.vars.customer_wrap_edit_item.hide(),t.vars.customer_wrap_editable.show(),e(".kbs_user_search_results").html("")})},add_email:function(){e(document.body).on("click","#add-customer-email",function(s){s.preventDefault();var t=e(this),a=t.parent();a.parent().find(".notice-wrap").remove(),a.find(".spinner").css("visibility","visible"),t.attr("disabled",!0);var i=a.find('input[name="customer-id"]').val(),o=a.find('input[name="additional-email"]').val(),n=a.find('input[name="make-additional-primary"]').is(":checked"),l=a.find('input[name="add_email_nonce"]').val();e.post(ajaxurl,{kbs_action:"customer-add-email",customer_id:i,email:o,primary:n,_wpnonce:l},function(e){!0===e.success?window.location.href=e.redirect:(t.attr("disabled",!1),a.after('<div class="notice-wrap"><div class="notice notice-error inline"><p>'+e.message+"</p></div></div>"),a.find(".spinner").css("visibility","hidden"))},"json")})},user_search:function(){e(document.body).on("click.kbsSelectUser",".kbs_user_search_results a",function(s){s.preventDefault();var a=e(this).data("userid");t.vars.user_id.val(a)})},remove_user:function(){e(document.body).on("click","#disconnect-customer",function(s){s.preventDefault();var t={kbs_action:"disconnect-userid",customer_id:e('input[name="customerinfo[id]"]').val(),_wpnonce:e("#edit-customer-info #_wpnonce").val()};e.post(ajaxurl,t,function(){window.location.href=window.location.href},"json")})},add_note:function(){e(document.body).on("click","#add-customer-note",function(s){s.preventDefault();var a={kbs_action:"add-customer-note",customer_id:e("#customer-id").val(),customer_note:t.vars.note.val(),add_customer_note_nonce:e("#add_customer_note_nonce").val()};if(a.customer_note)e.ajax({type:"POST",data:a,url:ajaxurl,success:function(s){e("#kbs-customer-notes").prepend(s),e(".kbs-no-customer-notes").hide(),t.vars.note.val("")}}).fail(function(e){window.console&&window.console.log&&console.log(e)});else{var i=t.vars.note.css("border-color");t.vars.note.css("border-color","red"),setTimeout(function(){t.vars.note.css("border-color",i)},500)}})},delete_checked:function(){e("#kbs-customer-delete-confirm").change(function(){var s=e("#kbs-delete-customer");e(this).prop("checked")?s.attr("disabled",!1):s.attr("disabled",!0)})}};t.init(),({init:function(){this.contacts()},contacts:function(){e("#_kbs_company_customer").change(function(){if(0!==e("#_kbs_company_customer").val()){var s={action:"kbs_get_customer_data",company_id:kbs_vars.post_id,customer_id:e("#_kbs_company_customer").val(),nonce:kbs_ajax_nonce};e.ajax({type:"POST",dataType:"json",data:s,url:ajaxurl,success:function(s){e("#_kbs_company_contact").val(s.name),e("#_kbs_company_email").val(s.email),e("#_kbs_company_phone").val(s.phone),e("#_kbs_company_website").val(s.url)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}})}}).init(),({init:function(){this.submit(),this.dismiss_message()},submit:function(){var s=this;e(document.body).on("submit",".kbs-export-form",function(t){t.preventDefault();var a=e(this).find('input[type="submit"]');if(!a.hasClass("button-disabled")){var i=e(this).serialize();a.addClass("button-disabled"),e(this).find(".notice-wrap").remove(),e(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="kbs-progress"><div></div></div></div>'),s.process_step(1,i,s)}})},process_step:function(s,t,a){e.ajax({type:"POST",url:ajaxurl,data:{form:t,action:"kbs_do_ajax_export",step:s},dataType:"json",success:function(s){if("done"===s.step||s.error||s.success){var i=e(".kbs-export-form").find(".kbs-progress").parent().parent(),o=i.find(".notice-wrap");if(i.find(".button-disabled").removeClass("button-disabled"),s.error){var n=s.message;o.html('<div class="updated error"><p>'+n+"</p></div>")}else if(s.success){var l=s.message;o.html('<div id="kbs-batch-success" class="updated notice is-dismissible"><p>'+l+'<span class="notice-dismiss"></span></p></div>')}else o.remove(),window.location=s.url}else e(".kbs-progress div").animate({width:s.percentage+"%"},50,function(){}),a.process_step(parseInt(s.step),t,a)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},dismiss_message:function(){e("body").on("click","#kbs-batch-success .notice-dismiss",function(){e("#kbs-batch-success").parent().slideUp("fast")})}}).init(),e(".kbs-ajax-user-search").keyup(function(){var s=e(this).val(),t="";e(this).data("exclude")&&(t=e(this).data("exclude")),e(".kbs-ajax").show();var a={action:"kbs_search_users",user_name:s,exclude:t};document.body.style.cursor="wait",e.ajax({type:"POST",data:a,dataType:"json",url:ajaxurl,success:function(s){e(".kbs-ajax").hide(),e(".kbs_user_search_results").removeClass("hidden"),e(".kbs_user_search_results span").html(""),e(s.results).appendTo(".kbs_user_search_results span"),document.body.style.cursor="default"}})}),e(document.body).on("click.kbsSelectUser",".kbs_user_search_results span a",function(s){s.preventDefault();var t=e(this).data("login");e(".kbs-ajax-user-search").val(t),e(".kbs_user_search_results").addClass("hidden"),e(".kbs_user_search_results span").html("")}),e(document.body).on("click.kbsCancelUserSearch",".kbs_user_search_results a.kbs-ajax-user-cancel",function(s){s.preventDefault(),e(".kbs-ajax-user-search").val(""),e(".kbs_user_search_results").addClass("hidden"),e(".kbs_user_search_results span").html("")}),e("#kbs_dashboard_tickets").length&&e.ajax({type:"GET",data:{action:"kbs_load_dashboard_widget"},url:ajaxurl,success:function(s){e("#kbs_dashboard_tickets .inside").html(s)}}),e(document).on("keydown",".customer-note-input",function(s){13===s.keyCode&&(s.metaKey||s.ctrlKey)&&e("#add-customer-note").click()})}),KBSShowNotice={warn:function(e){return void 0===e&&(e="ticket"),!!confirm(kbs_vars.delete_ticket_warn||"")},note:function(e){alert(e)}};